diff -uNr xserver690/xc/programs/Xserver/hw/nxagent/Millis.c hw/nxagent/Millis.c
--- xserver690/xc/programs/Xserver/hw/nxagent/Millis.c	1970-01-01 01:00:00.000000000 +0100
+++ hw/nxagent/Millis.c	2015-05-21 22:25:41.610997591 +0200
@@ -0,0 +1,70 @@
+/**************************************************************************/
+/*                                                                        */
+/* Copyright (c) 2001, 2011 NoMachine, http://www.nomachine.com/.         */
+/*                                                                        */
+/* NXAGENT, NX protocol compression and NX extensions to this software    */
+/* are copyright of NoMachine. Redistribution and use of the present      */
+/* software is allowed according to terms specified in the file LICENSE   */
+/* which comes in the source distribution.                                */
+/*                                                                        */
+/* Check http://www.nomachine.com/licensing.html for applicability.       */
+/*                                                                        */
+/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
+/*                                                                        */
+/* All rights reserved.                                                   */
+/*                                                                        */
+/**************************************************************************/
+
+#include <time.h>
+#include <stdio.h>
+
+#include "Xos.h"
+#include "Millis.h"
+
+#ifdef DDXTIME
+
+CARD32 GetTimeInMillis()
+{
+  struct timeval ts;
+
+  X_GETTIMEOFDAY(&ts);
+
+  return(ts.tv_sec * 1000) + (ts.tv_usec / 1000);
+}
+
+#endif
+
+const char *GetTimeAsString()
+{
+  char *value;
+
+  struct timeval ts;
+
+  X_GETTIMEOFDAY(&ts);
+
+  value = ctime((time_t *) &ts.tv_sec);
+
+  *(value + strlen(value) - 1) = '\0';
+
+  return value;
+}
+
+const char *GetTimeInMillisAsString()
+{
+  char *value;
+
+  char tb[25];
+
+  struct timeval ts;
+
+  X_GETTIMEOFDAY(&ts);
+
+  value = ctime((time_t *) &ts.tv_sec);
+
+  sprintf(tb, "%.8s:%3.3f", value + 11,
+              (float) ts.tv_usec / 1000);
+
+  strncpy(value, tb, 24);
+
+  return value;
+}

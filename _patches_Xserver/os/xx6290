diff -uNr xserver690/xc/programs/Xserver/os/Imakefile os/Imakefile
--- xserver690/xc/programs/Xserver/os/Imakefile	2005-03-23 20:58:45.000000000 +0100
+++ os/Imakefile	2015-06-10 21:19:39.031214174 +0200
@@ -5,12 +5,47 @@
 
 XCOMM $XFree86: xc/programs/Xserver/os/Imakefile,v 3.40 2003/09/09 03:20:41 dawes Exp $
 
+/**************************************************************************/
+/*                                                                        */
+/* Copyright (c) 2001, 2011 NoMachine, http://www.nomachine.com/.         */
+/*                                                                        */
+/* NX-X11, NX protocol compression and NX extensions to this software     */
+/* are copyright of NoMachine. Redistribution and use of the present      */
+/* software is allowed according to terms specified in the file LICENSE   */
+/* which comes in the source distribution.                                */
+/*                                                                        */
+/* Check http://www.nomachine.com/licensing.html for applicability.       */
+/*                                                                        */
+/* NX and NoMachine are trademarks of Medialogic S.p.A.                   */
+/*                                                                        */
+/* All rights reserved.                                                   */
+/*                                                                        */
+/**************************************************************************/
+ 
 #include <Server.tmpl>
 
 /*
  * If you have any extra files to be put into the library, define them here.
  */
 
+#if NXLibraries
+
+NX_INCLUDES = -I../../../../nxcomp
+
+NX_DEFINES = -DNX_TRANS_SOCKET        \
+             -DNX_TRANS_AUTH          \
+             -DNX_TRANS_FOPEN         \
+             -DNX_TRANS_SLEEP         \
+             -DNX_TRANS_EXIT          \
+             -DNX_TRANS_WAKEUP=1000
+
+#            -DNX_TRANS_WARN          \
+#            -DNX_TRANS_INFO          \
+#            -DNX_TRANS_TEST          \
+#            -DNX_TRANS_DEBUG         \
+
+#endif
+
 /*
  * do not modify the following two definitions
  */
@@ -128,10 +163,10 @@
         DEFINES = -DXSERV_t -DTRANS_SERVER $(CONNECTION_FLAGS) $(MEM_DEFINES) \
 		  $(XDMAUTHDEFS) $(RPCDEFS) $(SIGNAL_DEFINES) $(OS_DEFINES) \
 		  $(KRB5_DEFINES) $(RGB_DEFINES) $(GETPEER_DEFINES) \
-		  $(RANDOM_DEFINES) $(BUGMSG) $(XTRANS_FAILDEFINES)
+		  $(RANDOM_DEFINES) $(BUGMSG) $(XTRANS_FAILDEFINES) $(NX_DEFINES)
        INCLUDES = -I. -I../include -I$(XINCLUDESRC) -I$(EXTINCSRC) \
 		  -I$(SERVERSRC)/Xext -I$(FONTINCSRC) -I$(SERVERSRC)/render \
-		  -I$(TOP)/lib/Xau -I../lbx -I../Xprint Krb5Includes
+		  -I$(TOP)/lib/Xau -I../lbx -I../Xprint Krb5Includes $(NX_INCLUDES)
  DEPEND_DEFINES = $(DBM_DEFINES) $(XDMCP_DEFINES) $(EXT_DEFINES) \
 		  $(TRANS_INCLUDES) $(CONNECTION_FLAGS) $(GETPEER_DEFINES) \
 		  DependDefines
